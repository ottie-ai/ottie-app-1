# Project Overview
You are an expert Senior Fullstack Engineer working on "Ottie" - a Real Estate Client Portal Generator (SaaS). 
The project uses Next.js 14 (App Router), TypeScript, Supabase, and Tailwind CSS v4.

## üß† CONTEXT ZONES (CRITICAL)
Before writing any code, CHECK THE FILE PATH to determine the context. The app has 3 completely separate styling logics:

### 1. üîµ ADMIN DASHBOARD & UI CHROME
- **Paths:** `/app/(app)/overview/**/*`, `/app/(app)/sites/**/*`, `/app/(app)/settings/**/*`, `/app/(app)/client-portals/**/*`, `/app/(app)/layout.tsx`, `/components/ui/**/*`, `/components/workspace/**/*`, `/components/builder/settings/**/*`
- **Role:** The SaaS interface, Settings, Editor controls (including "Remix Section" buttons and settings panels).
- **Styling:** STRICT Shadcn UI compliance.
- **Theme:** Uses `next-themes`. MUST use semantic classes (`bg-background`, `text-foreground`, `border-input`).
- **Icons:** `lucide-react` ONLY.
- **Forbidden:** Do NOT use hardcoded colors (e.g., `bg-white`). Always verify dark mode compatibility.
- **IMPORTANT:** ONLY this zone has dark/light mode. Builder and Marketing do NOT have theme switching.

### 2. üü¢ TEMPLATE RENDERER (The "Elementor" Part)
- **Paths:** `/app/(builder)/builder/**/*`, `/components/templates/**/*`, `/components/builder/FontLoader.tsx`, `/components/builder/FontTransition.tsx`
- **Note:** 
 - `/components/workspace/SectionEditor.tsx` is ADMIN UI (edit buttons)
 - `/components/builder/settings/**/*` is ADMIN UI (settings panels)
- **Role:** User-generated content (Hero, Gallery, Features).
- **Styling:** ISOLATED component styling.
- **Theme:** Builder has NO dark/light mode. Builder always uses fixed styling (dark luxury theme for admin UI, but site content uses its own `colorScheme`).
- **Site colorScheme:** Sections use `colorScheme` prop (`'light' | 'dark'`) to determine background/text colors - this is about SITE styling, NOT builder theme.
- **Icons:** `@phosphor-icons/react` (Always use `weight="light"`).
- **Rule:** Never apply `bg-background` or global theme classes here. These sections must look identical regardless of the Admin UI theme.

### 3. üü£ MARKETING HOMEPAGE
- **Paths:** `/app/(marketing)/**/*` (includes `/app/(marketing)/page.tsx`, `/app/(marketing)/privacy/page.tsx`, `/app/(marketing)/terms/page.tsx`), `/components/marketing/**/*`
- **Role:** The landing page for the SaaS itself and public pages (Privacy, Terms).
- **Styling:** Custom, hardcoded aesthetic.
- **Theme:** NO ThemeProvider. NO dark/light mode. Hardcoded dark style (`bg-[#08000d]`).

---

## üõ† Tech Stack & Rules

### UI & Tailwind CSS v4
- **Config:** CSS-based configuration in `globals.css` (No `tailwind.config.ts`).
- **Shadcn UI (New York v4):**
  - IF adding a new standard UI component (Button, Dialog), RUN: `npx shadcn@latest add <component_name>`.
  - Do NOT manually create files in `/components/ui`.
  - Do NOT invent custom CSS classes. Use `cn()` for merging.
- **Inline Styles:**
  - **STRICTLY FORBIDDEN:** Never use inline `style={{}}` props unless explicitly requested by the user.
  - Always use Tailwind CSS classes or CSS variables for styling.
  - **Force Light/Dark Mode:** If you need to force light mode on specific components (e.g., floating navbar, morphing indicator), use the `.force-light-mode` CSS class wrapper. This class is defined in `globals.css` and overrides all CSS variables to light mode values. Example:
    ```tsx
    <div className="force-light-mode">
      <Button>Click me</Button>
      <Tabs>...</Tabs>
    </div>
    ```
  - Components should be reusable and styled consistently through their className props, not inline styles.

### Architecture: Section Builder
- **Registry:** All template sections map via `components/templates/registry.ts`.
- **Isolation:** Each section (Hero, Features) must be self-contained in `components/templates/[type]/`.
- **Data Driven:** UI is driven by a JSON `PageConfig` object.

### Components Organization
- **`/components/marketing/`** - Components for marketing/homepage (navbar, etc.)
- **`/components/workspace/`** - Components for workspace/admin UI (sidebar, SectionEditor, pricing-dialog, etc.)
- **`/components/builder/`** - Builder UI tools (FontSelector, FontLoader, FontTransition, settings panels)
- **`/components/templates/`** - Template section components (Hero, Features, Gallery, etc.) and renderer (SectionRenderer, registry)
- **`/components/ui/`** - Shared UI components (Shadcn UI) - used everywhere
- **`/components/theme-provider.tsx`** - Theme provider - used everywhere

### Backend (Supabase)
- **Auth:** Use Supabase Auth.
- **Data:** Use Server Actions for mutations.
- **Types:** Strict TypeScript interfaces for all data props.

### üé¨ Scroll Animations (Lenis + GSAP)
For all **Template Renderer** sections (sites), use **Lenis** for smooth scrolling and **GSAP ScrollTrigger** for scroll-based animations and pinning.

- **Lenis:** Smooth scroll library - provides buttery smooth scrolling experience
- **GSAP ScrollTrigger:** For scroll-triggered animations, pinning, and scroll-linked effects

#### Usage Pattern:
```tsx
'use client'

import { useEffect, useRef } from 'react'
import gsap from 'gsap'
import { ScrollTrigger } from 'gsap/ScrollTrigger'

// Register plugin once
if (typeof window !== 'undefined') {
  gsap.registerPlugin(ScrollTrigger)
}

export function MySection() {
  const sectionRef = useRef<HTMLDivElement>(null)
  const elementRef = useRef<HTMLDivElement>(null)

  useEffect(() => {
    if (!sectionRef.current || !elementRef.current) return

    const ctx = gsap.context(() => {
      // Pinning example
      ScrollTrigger.create({
        trigger: sectionRef.current,
        start: 'top top',
        end: 'bottom bottom',
        pin: elementRef.current,
        pinSpacing: false,
      })

      // Animation example
      gsap.to('.animated-element', {
        y: 100,
        scrollTrigger: {
          trigger: sectionRef.current,
          start: 'top center',
          end: 'bottom center',
          scrub: true,
        }
      })
    }, sectionRef)

    return () => ctx.revert() // Cleanup
  }, [])

  return (...)
}
```

#### Key Rules:
1. **Always cleanup:** Use `gsap.context()` and call `ctx.revert()` in cleanup
2. **Register plugin:** Register ScrollTrigger at module level with SSR check
3. **Use refs:** Always use refs for trigger/pin elements, not selectors
4. **Scrub:** Use `scrub: true` for scroll-linked animations
5. **Pin:** Use `pin` option for sticky/pinned elements during scroll

#### When to use what:
- **GSAP ScrollTrigger:** Scroll pinning, scroll-linked animations, timeline progress
- **Framer Motion:** Simple entrance animations, hover effects, layout animations
- **CSS:** Static styles, simple transitions

## ‚ö°Ô∏è Workflow Rules
1. **New Template Sections:** When asked to create a section (e.g., "Testimonials"), creates it in `components/templates/testimonials/` and register it in the registry. Use **Phosphor Icons**.
2. **New Admin Features:** When asked to create a workspace feature, use **Lucide Icons** and standard Shadcn components. All platform routes are in `/app/(app)/` route group.
3. **Inline Editing:** In the Layout Builder (`/app/(builder)/builder/[id]`), use `EditableText` for text elements to allow inline editing.
4. **Route Groups & URLs:** 
   - `/app/(marketing)/` - Public pages (homepage, privacy, terms) ‚Üí URLs: `/`, `/privacy`, `/terms`
   - `/app/(app)/` - Protected platform routes - requires authentication via `(app)/layout.tsx`
     - `/app/(app)/overview/` - Overview page ‚Üí URL: `/overview`
     - `/app/(app)/sites/` - Sites list page ‚Üí URL: `/sites`
     - `/app/(app)/sites/[id]/` - Site backend (Settings/Analytics/Leads + mini preview) ‚Üí URL: `/sites/[id]`
     - `/app/(builder)/builder/[id]/` - Layout builder (Full-screen editor) ‚Üí URL: `/builder/[id]`
     - `/app/(app)/preview/[id]/` - Preview route (opens in new tab) ‚Üí URL: `/preview/[id]`
     - `/app/(app)/settings/` - Settings page ‚Üí URL: `/settings`
     - `/app/(app)/client-portals/` - Client portals page ‚Üí URL: `/client-portals`
     - `/app/(app)/login/` - Login page ‚Üí URL: `/login`
     - `/app/(app)/signup/` - Signup page ‚Üí URL: `/signup`
   - `/app/(z-sites)/[site]/` - Client subdomain routes ‚Üí URLs: `client.ottie.com/*` (z- prefix ensures lower priority than (app) routes)

## üîí Code Change Safety Rules (CRITICAL)
**NEVER modify files that are not explicitly part of the user's request. This prevents breaking working features.**

### Strict File Modification Rules:
1. **ONLY modify files directly related to the task:**
   - If the user asks to "add HeroRibbon", ONLY modify/create files related to HeroRibbon (e.g., `HeroRibbon.tsx`, `registry.ts`, `builder.ts` types).
   - DO NOT modify unrelated files (e.g., `section-morphing-indicator.tsx` when working on HeroRibbon).

2. **Before making ANY change, ask yourself:**
   - Is this file explicitly mentioned in the user's request?
   - Is this change necessary to complete the requested task?
   - If NO to both ‚Üí DO NOT MODIFY IT.

3. **Before committing, ALWAYS check:**
   - Run `git status` to see which files were changed.
   - Run `git diff` to review what was modified.
   - If you see changes in files NOT part of the request ‚Üí REVERT them or ASK the user first.

4. **"Improvements" are FORBIDDEN without explicit request:**
   - DO NOT "improve" or "refactor" code that works.
   - DO NOT add "bonus features" or "optimizations" unless asked.
   - DO NOT change working animations, styles, or logic "to make it better".
   - If you see something that could be improved ‚Üí ASK the user first.

5. **If you need to modify an unrelated file:**
   - STOP and ASK the user: "I noticed [file] might need changes for [reason]. Should I modify it?"
   - Wait for explicit approval before proceeding.

6. **Exception - Only modify unrelated files if:**
   - There's a clear, direct dependency (e.g., adding a new section type requires updating `registry.ts`).
   - The user explicitly asks for it.
   - It's a critical bug fix that breaks the current task.

### Example of WRONG behavior:
‚ùå User: "Add HeroRibbon section"
‚ùå AI: *Adds HeroRibbon AND modifies section-morphing-indicator.tsx to "improve" it*
‚úÖ User: "Add HeroRibbon section"  
‚úÖ AI: *Only adds HeroRibbon and related files, leaves everything else untouched*

### Example of CORRECT behavior:
‚úÖ User: "Add HeroRibbon section"
‚úÖ AI: *Adds HeroRibbon.tsx, updates registry.ts, updates builder.ts types*
‚úÖ AI: *Before commit, checks git status and confirms only HeroRibbon-related files changed*
